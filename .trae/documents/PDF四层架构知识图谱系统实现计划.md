# PDF四层架构知识图谱系统实现计划

## 1. 项目概述
基于现有PDF拆分功能，扩展实现"书-章-节-知识点"四层知识架构体系，并构建知识图谱可视化系统。使用大模型API（如千问）进行知识点和关系抽取。

## 2. 数据模型设计
### 2.1 四层架构数据模型
- **BookInfo**: 书籍信息模型
  - id, title, author, description, total_pages, created_at
  - chapters: List[ChapterInfo] (一对多关系)

- **ChapterInfo**: 章节信息模型（扩展现有模型）
  - id, book_id, title, start_page, end_page, page_count
  - sections: List[SectionInfo] (一对多关系)

- **SectionInfo**: 节信息模型
  - id, chapter_id, title, start_page, end_page, page_count
  - knowledge_points: List[KnowledgePoint] (一对多关系)

- **KnowledgePoint**: 知识点模型
  - id, section_id, title, content, start_page, end_page, page_count
  - related_points: List[str] (关联知识点ID，多对多关系)

### 2.2 知识图谱模型
- **KnowledgeGraph**: 知识图谱模型
  - book_id, nodes, edges

- **GraphNode**: 知识节点
  - id, type (book/chapter/section/knowledge), content, metadata

- **GraphEdge**: 关系边
  - source_id, target_id, relation_type, weight

## 3. 核心功能实现
### 3.1 增强PDF分析能力
- **多层级结构提取**: 从PDF书签或文本中提取章节、节、知识点
- **大模型集成**: 调用千问等大模型API分析文本内容
- **知识点识别**: 使用大模型从文本中识别知识点
- **关系抽取**: 使用大模型识别知识点间的关联关系
- **章节-节-知识点映射**: 建立层级间的父子关系

### 3.2 知识图谱构建
- **节点生成**: 为每层架构创建知识节点
- **大模型关系抽取**: 调用大模型API提取知识点间的关联关系
- **图谱构建**: 基于大模型返回结果构建知识图谱
- **图谱存储**: 使用图数据库或结构化存储保存知识图谱

### 3.3 可视化系统开发
- **层级可视化**: 直观展示四层架构的层级关系
- **关系展示**: 可视化知识点间的关联关系
- **交互功能**: 支持节点展开/折叠、关系查看、搜索定位
- **缩放功能**: 支持视图缩放、重置和自适应布局
- **响应式设计**: 适配不同屏幕尺寸
- **节点详情**: 显示节点详细信息
- **重新构建功能**: 提供重新构建知识图谱的按钮，允许用户在现有图谱基础上重新生成图谱

## 4. 技术架构
### 4.1 后端扩展
- **API扩展**: 新增知识图谱相关API
- **大模型服务**: 新增大模型调用服务，处理API请求和响应
- **知识图谱服务**: 新增知识图谱构建服务，集成大模型API
- **数据层**: 扩展数据库模型支持四层架构
- **配置管理**: 添加大模型API密钥和参数配置

### 4.2 前端扩展
- **可视化组件**: 集成D3.js或Neo4j等可视化库
- **交互界面**: 新增四层架构管理界面
- **状态管理**: 扩展状态管理支持新数据模型

## 5. 大模型API集成方案
### 5.1 模型选择
- 优先使用千问模型，支持文本分析和关系抽取
- 可扩展支持其他主流大模型

### 5.2 提示词设计
- **知识点提取提示词**: 设计提示词从文本中提取知识点
- **关系抽取提示词**: 设计提示词识别知识点间的关联关系
- **格式规范**: 要求大模型返回结构化数据，便于解析

### 5.3 API调用机制
- **异步调用**: 使用异步方式调用大模型API，避免阻塞
- **重试机制**: 实现API调用失败重试机制
- **速率限制**: 处理大模型API的速率限制
- **缓存机制**: 缓存大模型调用结果，提高效率

## 6. 实现步骤
1. **数据模型扩展**: 更新`schemas.py`，添加四层架构和知识图谱模型
2. **大模型服务实现**: 新增`llm_service.py`，实现大模型API调用
3. **PDF分析增强**: 修改`pdf_analyzer.py`，集成大模型分析
4. **知识图谱服务**: 新增`knowledge_graph_service.py`，实现图谱构建逻辑
5. **API扩展**: 更新`routes.py`，新增知识图谱相关API
6. **前端可视化**: 集成D3.js或Neo4j等可视化库，实现知识图谱展示
7. **界面优化**: 更新前端组件，支持四层架构的编辑和管理
8. **测试验证**: 编写测试用例，验证新功能的正确性
9. **文档更新**: 更新API文档和使用说明

## 7. 预期成果
- 实现"书-章-节-知识点"四层知识架构
- 集成大模型API进行知识点和关系抽取
- 构建完整的知识图谱可视化系统
- 支持知识节点间的层级关系和关联关系展示
- 提供直观的交互界面，方便用户管理和查看知识结构

## 8. 风险评估
- **PDF结构复杂性**: 不同PDF格式可能导致层级提取不准确
- **大模型API稳定性**: 依赖外部API，可能存在调用失败风险
- **大模型分析精度**: 知识点识别和关系抽取的准确性依赖于大模型质量
- **可视化性能**: 大规模知识图谱的渲染性能需要优化

## 9. 后续优化方向
- 支持多模型切换和比较
- 增强大模型提示词，提高抽取精度
- 支持多文档知识图谱融合
- 提供知识图谱智能搜索和推荐功能
- 支持自定义知识图谱样式和布局